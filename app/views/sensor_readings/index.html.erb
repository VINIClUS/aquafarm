<div class="relative overflow-x-auto shadow-md sm:rounded-lg mb-3">
  <h1 class="<%= ui_title_classes %>">Leituras de Sensores <%= @pond ? "— #{@pond.name}" : "" %></h1>
  <hr>
</div>
<div class="card mb-4">
    <%= form_with url: (@pond ? pond_sensor_readings_path(@pond) : sensor_readings_path),
              method: :get, local: true, scope: nil,
              class: "grid grid-cols-1 md:grid-cols-3 gap-3 items-end" do |f| %>
    
        <div class="md:col-span-1">
          <%= label_tag :pond_id, "Tanque", class: ui_label_classes %>
          <%= select_tag :pond_id,
                options_from_collection_for_select(
                  policy_scope(Pond), :id, :name,
                  params[:pond_id].presence || @pond&.id
                ),
                class: ui_input_classes %>
        </div>

        <div>
          <%= f.label :start_at, "Início", class: ui_label_classes %>
          <%= f.date_field :start_at, value: params[:start_at], class: ui_input_classes %>
        </div>

        <div>
          <%= f.label :end_at, "Fim", class: ui_label_classes %>
          <%= f.date_field :end_at, value: params[:end_at], class: ui_input_classes %>
        </div>

        <div class="flex gap-2">
          <%= f.submit "Filtrar", class: ui_btn_primary %>
          <%= link_to "Limpar",
                sensor_readings_path,
                class: ui_btn_danger %>
        </div>
    <% end %>
</div>

<div class="mb-3 flex flex-wrap gap-2">
  <%= link_to "Exportar CSV",
      (@pond ? pond_sensor_readings_path(@pond, format: :csv, start_at: params[:start_at], end_at: params[:end_at]) :
               sensor_readings_path(format: :csv, start_at: params[:start_at], end_at: params[:end_at])),
      class: ui_btn_primary %>

  <% if @pond %>
    <%= link_to "JSON (médias diárias)",
        pond_sensor_readings_path(@pond, format: :json, aggregate: :daily, start_at: params[:start_at], end_at: params[:end_at]),
        class: ui_btn_primary %>

    <%= link_to "JSON (série temporal)",
        timeseries_pond_sensor_readings_path(@pond, format: :json, n: 300, metrics: "temp_c,ph", stride: 1, start_at: params[:start_at], end_at: params[:end_at]),
        class: ui_btn_primary %>
  <% end %>
</div>

<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
  <div class="bg-white dark:bg-gray-900">
    <table class="<%= t_table %>">
      <thead class="<%= t_thead %>">
        <tr>
          <th class="<%= t_th_small %>">Data/Hora</th>
          <th class="<%= t_th_small %>">Temp (°C)</th>
          <th class="<%= t_th_small %>">pH</th>
          <th class="<%= t_th_small %>">OD (mg/L)</th>
          <th class="<%= t_th_small %>">Turb.(NTU)</th>
          <th class="<%= t_th_small %>">Sal.(ppt)</th>
          <th class="<%= t_th_small %>" colspan="2">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% @sensor_readings.each do |r| %>
          <tr class="<%= t_tr %>">
            <td class="<%= t_td_small %>"><%= l r.reading_time, format: :short %></td>
            <td class="<%= t_td_small %>"><%= r.temp_c %></td>
            <td class="<%= t_td_small %>"><%= r.ph %></td>
            <td class="<%= t_td_small %>"><%= r.do_mg_l %></td>
            <td class="<%= t_td_small %>"><%= r.turbidity_ntu %></td>
            <td class="<%= t_td_small %>"><%= r.salinity_ppt %></td>
            <td class="<%= t_td_small %>">
              <div class="<%= t_actions %>">
                <%= link_to "Ver", pond_sensor_reading_path(r.pond, r), class: t_link_primary %> |
                <%= link_to 'Apagar', pond_sensor_reading_path(r.pond, r), class: t_link_danger,
                            data: { turbo_method: :delete, turbo_confirm: 'Tem certeza?' } %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>